{"version":3,"file":"static/js/211.b4f1449b7.chunk.js","mappings":"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","sources":["webpack://vitesandbox-client/./node_modules/image-size/lib/types/ sync ^\\.\\/.*$","webpack://vitesandbox-client/./node_modules/less/lib/less-node/ sync","webpack://vitesandbox-client/./node_modules/vite/dist/browser/ sync","webpack://vitesandbox-client/./src/utils/polyfill/esbuild.js","webpack://vitesandbox-client/./src/utils/polyfill/fs.js","webpack://vitesandbox-client/./src/utils/polyfill/global.js","webpack://vitesandbox-client/./src/utils/polyfill/module.js","webpack://vitesandbox-client/./src/utils/polyfill/perfHooks.js","webpack://vitesandbox-client/./src/utils/polyfill/url.js","webpack://vitesandbox-client/./src/utils/index.js","webpack://vitesandbox-client/./src/utils/initFiles/index.js","webpack://vitesandbox-client/./src/vite/plugins/viteClientPlugin.js","webpack://vitesandbox-client/./src/vite/plugins/nodeResolvePlugin.js","webpack://vitesandbox-client/./src/vite/plugins/htmlPlugin.js","webpack://vitesandbox-client/./src/vite/optimize.js","webpack://vitesandbox-client/./src/vite/server.js","webpack://vitesandbox-client/./src/vite/index.js","webpack://vitesandbox-client/./src/utils/channel.js"],"sourcesContent":["var map = {\n\t\"./bmp\": 46084,\n\t\"./bmp.js\": 46084,\n\t\"./dds\": 74344,\n\t\"./dds.js\": 74344,\n\t\"./gif\": 16727,\n\t\"./gif.js\": 16727,\n\t\"./jpg\": 76129,\n\t\"./jpg.js\": 76129,\n\t\"./png\": 27963,\n\t\"./png.js\": 27963,\n\t\"./psd\": 57085,\n\t\"./psd.js\": 57085,\n\t\"./svg\": 11445,\n\t\"./svg.js\": 11445,\n\t\"./tiff\": 35371,\n\t\"./tiff.js\": 35371,\n\t\"./webp\": 10288,\n\t\"./webp.js\": 10288\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 19015;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 77027;\nmodule.exports = webpackEmptyContext;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 1802;\nmodule.exports = webpackEmptyContext;","import * as esbuild from 'esbuild-wasm';\n\nlet initializePromise;\n\nfunction initialize() {\n  if (!initializePromise) {\n    initializePromise = esbuild.initialize({\n      worker: typeof Worker != 'undefined',\n      wasmURL: 'https://www.unpkg.com/esbuild-wasm@0.14.47/esbuild.wasm' // todo: version\n    });\n  }\n  return initializePromise;\n}\n\nfunction build(e) {\n  return initialize().then(() => esbuild.build(e));\n}\n\nfunction transform(e, r) {\n  return initialize().then(() => esbuild.transform(e, r));\n}\n\nfunction formatMessages(e, r) {\n  return initialize().then(() => esbuild.formatMessages(e, r));\n}\n\nfunction startService() {\n  return initialize().then(() => ({\n    transform: esbuild.transform,\n    build: esbuild.build\n  }));\n}\n\nexport {\n  build,\n  transform,\n  formatMessages,\n  startService\n};\n","import { fs } from 'memfs';\n\nexport const promises = fs.promises;\n\nexport default fs;\n","export default {};\n","const builtinModules = [\n  'assert',\n  'async_hooks',\n  'buffer',\n  'child_process',\n  'cluster',\n  'console',\n  'constants',\n  'crypto',\n  'dgram',\n  'dns',\n  'domain',\n  'events',\n  'fs',\n  'http',\n  'http2',\n  'https',\n  'inspector',\n  'module',\n  'net',\n  'os',\n  'path',\n  'perf_hooks',\n  'process',\n  'punycode',\n  'querystring',\n  'readline',\n  'repl',\n  'stream',\n  'string_decoder',\n  'timers',\n  'tls',\n  'trace_events',\n  'tty',\n  'url',\n  'util',\n  'v8',\n  'vm',\n  'wasi',\n  'worker_threads',\n  'zlib'\n];\n\nconst createRequire = () => {};\n\nexport {\n  builtinModules,\n  createRequire\n};\n","const performance = {\n  now: () => new Date().getTime()\n};\n\nexport {\n  performance\n};\n","import { parse } from 'node-url';\n\n// npm install --save node-url@npm:url\n\nconst URL = globalThis.URL;\nconst URLSearchParams = globalThis.URLSearchParams;\n\nfunction pathToFileURL(path) {\n  return new URL(path, 'file://');\n}\n\nfunction fileURLToPath(url) {\n  if (url.protocol === 'file:') {\n    return url.pathname;\n  }\n\n  throw new Error(`fileURLToPath(${url})`);\n}\n\nexport {\n  URL,\n  URLSearchParams,\n  parse,\n  pathToFileURL,\n  fileURLToPath\n};\n\n","import fs from 'fs';\nimport path from 'path';\n\nconst packageJsonPath = '/package.json';\n\nconst sandboxConfigJsonPath = '/sandbox.config.json';\n\nconst depBaseUrl = 'https://esm.sh';\n\n// 'react@16.8.0/cjs/react.development.js' -> \n// ['react/cjs/react.development.js', 'react', '16.8.0', '/cjs/react.development.js', ...]\nconst dependencyNameRE = /^((?:@[^/A-Z:]+\\/)?[^@/._A-Z:~)('!*][^@/A-Z:~)('!*]*)(?:@(.+?))?(\\/[^\\\\/].*?)?$/;\n\nconst configFileNames = ['tsconfig.json', 'jsconfig.json'];\n\nconst externalDependencies = ['react', 'react-dom'];\n\nconst setDomainCode = `\n  try {\n    // 修改 domain，以便让外部页面和 iframe 页面在同一个域名下，主要目的是为了直接监听 iframe 页面的事件 xxx\n    document.domain = window.location.hostname.split('.').slice(-2).join('.');\n  } catch (error) {\n    //\n  }\n`;\n\nfunction genImportMap(deps) {\n  const importMap = {\n    imports: {}\n  };\n  for (const depName of externalDependencies) {\n    const version = deps[depName];\n    if (version) {\n      importMap.imports[depName] = `${depBaseUrl}/${depName}@${version}?dev&bundle&external=${externalDependencies.join(',')}`;\n    } else {\n      importMap.imports[depName] = `${depBaseUrl}/${depName}@latest?dev&bundle&external=${externalDependencies.join(',')}`;\n    }\n  }\n\n  return JSON.stringify(importMap);\n}\n\nfunction writeFileSync(_path, contents) {\n  try {\n    fs.mkdirSync(path.dirname(_path), { recursive: true});\n    fs.writeFileSync(_path, contents);\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nfunction genSandboxConfigJson(tree) {\n  if (!(sandboxConfigJsonPath in tree)) {\n    return {\n      sandboxConfigJson: {}\n    };\n  }\n\n  try {\n    return {\n      sandboxConfigJson: JSON.parse(tree[sandboxConfigJsonPath])\n    };\n  } catch (error) {\n    tree[sandboxConfigJsonPath] = '{}';\n    error.message = `Parsing ${sandboxConfigJsonPath}: ${error.message}`;\n    return {\n      sandboxConfigJson: {},\n      parseError: error\n    };\n  }\n}\n\nfunction genPkgJson(tree) {\n  if (!(packageJsonPath in tree)) {\n    return {\n      pkgJson: {}\n    };\n  }\n\n  try {\n    return {\n      pkgJson: JSON.parse(tree[packageJsonPath])\n    };\n  } catch (error) {\n    tree[packageJsonPath] = '{}';\n    error.message = `Parsing ${packageJsonPath}: ${error.message}`;\n    return {\n      pkgJson: {},\n      parseError: error\n    };\n  }\n}\n\n// 基于 package.json 的 dependencies 初始化 deps 对象\nfunction initDeps(tree, deps) {\n  if (packageJsonPath in tree) {\n    const { dependencies } = JSON.parse(tree[packageJsonPath]);\n\n    Object.entries(dependencies || []).forEach(([name, version]) => {\n      const ver = deps[name];\n      if (ver) {\n        if (version !== ver) {\n          console.log(`Already pinned dependency: ${name}@${ver} (${version} requested, ignored)`);\n        }\n      } else {\n        deps[name] = version;\n      }\n    });\n  }\n}\n\nfunction writeProjectFiles(root, tree) { \n  for (const [filename, code] of Object.entries(tree)) {\n    writeFileSync(path.join(root, filename), code);\n  }\n}\n \nfunction genProjectInfo(tree, pkgJson, wcid) {\n  const { dependencies = {}, devDependencies = {}, peerDependencies = {} } = pkgJson;\n  const isSomeFrameWork = name => name in dependencies || name in devDependencies || name in peerDependencies;\n\n  return {\n    useReact: isSomeFrameWork('react'),\n    useSolid: isSomeFrameWork('solid-js'),\n    useVue: isSomeFrameWork('vue'),\n    useSvelte: isSomeFrameWork('svelte'),\n    useStencil: isSomeFrameWork('@stencil/core'),\n    dependencies,\n    devDependencies,\n    peerDependencies,\n    root: `/@root/${wcid}`,\n    configFiles: Object.fromEntries(configFileNames.map(configFileName => [configFileName, tree[configFileName]]))\n  };\n}\n\nfunction sendCompileError(channel, err, wcid) {\n  const error = Array.isArray(err) ? err : [err];\n  channel.publish('compile-error', {\n    wcid,\n    errors: error.map(e => ({\n      stack: e.stack,\n      message: e.message,\n      filename: e.filename,\n      lineno: e.start && e.start.line,\n      colno: e.start && e.start.column\n    }))\n  });\n}\n\nfunction getImageContentType(pathname) {\n  const extname = path.extname(pathname).slice(1);\n  switch (extname) {\n  case 'svg':\n    return 'image/svg+xml';\n  case 'jpeg':\n  case 'jpg':\n    return 'image/jpeg';\n  default:\n    return `image/${extname}`;\n  }\n}\n\nfunction _findPathName(pathNameArr, pathname) {\n  const i = new RegExp(`^${pathname}\\\\.(mdx?|html?|astro|njk)$`);\n  return pathNameArr.find(p => i.test(p));\n}\n\nfunction findPathName(pathname, pathNameArr) {\n  if (pathNameArr.includes(pathname)) {\n    return pathname;\n  }\n  if (pathname === '' || pathname.endsWith('/')) {\n    _findPathName(pathNameArr, `${pathname}index`);\n  }\n  if (!(new RegExp('\\\\.(mdx?|html?|astro|njk)$').test(pathname))) {\n    return _findPathName(pathNameArr, pathname);\n  }\n}\n\nfunction genErrorHtmlCode(channel, contentType, error, wcid) {\n  let code = `\n  import(/*@vite-ignore*/ '/${channel.channelName}/vite/${wcid}/@vite/client').then(({ handleMessage }) => handleMessage({\n      type: 'error',\n      err: ${JSON.stringify(error)},\n  }));\n  `;\n\n  if (contentType === 'text/html') {\n    code = `<!DOCTYPE html><html><head><script type='module'>${code}</script></head><body></body></html>`;\n  }\n  return code;\n}\n\nfunction enhanceErrorInfo(error, tree, path, pathname) {\n  if (error.plugin === 'vite:import-analysis') {\n    const [ , importer, source] = error.message?.match(/Failed to resolve import '([^']+)' from '([^']+)'/) || [];\n    const [ , dependency] = importer?.match(/^((?:@[^/A-Z:]+\\/)?[^@/._A-Z:~)('!*][^@/A-Z:~)('!*]*)(?:@(.+?))?(\\/[^\\\\/].*?)?$/) || [];\n    if (dependency) {\n      error.message = `Missing dependency '${dependency}' imported from '${source}'`;\n    }\n  } else if (!error.id) {\n    if (pathname && tree[pathname]) {\n      error.id = `/${pathname}`;\n    } else {\n      error.message = `Error processing ${pathname} ${error?.message}`;\n    }\n  }\n}\n\nexport {\n  dependencyNameRE,\n  depBaseUrl,\n  configFileNames,\n  externalDependencies,\n  setDomainCode,\n  genImportMap,\n  writeFileSync,\n  genSandboxConfigJson,\n  initDeps,\n  writeProjectFiles,\n  genProjectInfo,\n  sendCompileError,\n  getImageContentType,\n  findPathName,\n  genPkgJson,\n  genErrorHtmlCode,\n  enhanceErrorInfo\n};\n","import { writeFileSync } from '$utils';\nimport ReactRefreshRuntime from './reactRefreshRuntimeCode.js?raw';\n\nfunction initFiles() {\n  writeFileSync('/node_modules/react-refresh/cjs/react-refresh-runtime.development.js', ReactRefreshRuntime);\n}\n\n// 写入部分文件到内存文件系统\ninitFiles();\n","import { CLIENT_ENTRY, CLIENT_DIR, ENV_ENTRY } from 'vite';\nimport vite_client from './client.js?raw';\nimport vite_client_env from 'vite/dist/client/env.mjs?raw';\n\nconst viteClientPlugin = () => ({\n  name: 'vite:browser:hmr',\n  enforce: 'pre',\n  resolveId(id) {\n    if (id.startsWith(CLIENT_DIR)) {\n      return {\n        id: /\\.mjs$/.test(id) ? id : `${id}.mjs`,\n        external: true\n      };\n    }\n  },\n  load(id) {\n    if (id === CLIENT_ENTRY) {\n      return vite_client;\n    }\n    if (id === ENV_ENTRY) {\n      return vite_client_env;\n    }\n  }\n});\n\nexport default viteClientPlugin;\n","// import path from 'path';\nimport { dependencyNameRE, depBaseUrl, genPkgJson } from '$utils';\n\nconst nodeResolvePlugin = ({ tree }) => {\n  let server;\n  return {\n    name: 'vite:node:resolve',\n    enforce: 'pre',\n    configureServer(_server) {\n      server = _server;\n    },\n    resolveId(id, _, { ssr }) {\n      if (/dist\\/__require\\.js$/.test(id)) {\n        return '/dist/__require.js';\n      }\n              \n      const dependencyInfos = dependencyNameRE.exec(id);\n      if (dependencyInfos) {\n        if (ssr) {\n          return {\n            id,\n            external: true\n          };\n        }\n        const { _optimizeDepsMetadata } = server;\n        if (_optimizeDepsMetadata) {\n          // 从 optimized 中查询对应依赖代码在 cdn 上的地址\n          const depData = _optimizeDepsMetadata.optimized[id];\n          if (depData?.src) {\n            return {\n              id: depData.file,\n              external: true\n            };\n          }\n\n          // // 如果在 optimized 上不存在，但又是安装过的依赖，则将其添加到 optimized，并返回对应代码文件的路径\n          // server?._registerMissingImport?.call(server, id, id, undefined);\n          // return path.join('/node_modules', dependencyInfos[1], 'index.js');\n        }\n        \n        const [, dependencyName, , pathname] = dependencyInfos;\n        const { pkgJson, parseError } = genPkgJson(tree);\n        if (!parseError) {\n          const { dependencies } = pkgJson;\n          if (!dependencies[dependencyName]) {\n            throw new Error(`${dependencyName} not implicited in package.json`);\n          }\n\n          return {\n            id: `https://esm.sh/${dependencyName}@${dependencies[dependencyName]}${pathname}`,\n            external: true\n          };\n        }\n      }\n    },\n    load(id) {\n      // 如果是动态 import，则将动态 import 的函数代码返回\n      if (id === '/dist/__require.js') {\n        if (server?._optimizeDepsMetadata) {\n          return `\n            export default function require(library) {\n              const flat = library.replace(/[\\\\/\\\\.]/g, '_');\n              return import(/*@vite-ignore*/ ${JSON.stringify(depBaseUrl)}+flat).then(m => ({...m, ...m.default}));\n            }\n        `;\n        } else {\n          console.warn('Trying to access dynamic require but dependencies aren\\'t optimized yet');\n          return `\n            export default function require(library) {\n                throw new Error('Missing library: ' + library)\n            }`;\n        }\n      }\n    }\n  };\n};\n\nexport default nodeResolvePlugin;\n","import { genSandboxConfigJson, setDomainCode, genImportMap, initDeps } from '$utils';\n\nexport function resourceIsCss(resource) {\n  // 兼容 url 带 search 的情况\n  // 例如：https://xxx/sandbox.base.css?v=0\n  const pathname = new URL(resource).pathname;\n  const match = pathname.match(/\\.([^.]*)$/);\n\n  return (match && match[1] === 'css') || resource.includes('fonts.googleapis');\n}\n\nconst htmlPlugin = ({ tree }) => ({\n  name: 'vite:html:transform',\n  transformIndexHtml: {\n    enforce: 'pre',\n    transform(html) {\n      const deps = {};\n      // 基于 package.json 的 dependencies 初始化 deps 对象\n      initDeps(tree, deps);\n\n      // 默认注入修改 domain 的 js 代码\n      const tags = [\n        {\n          tag: 'script',\n          attrs: {\n            type: 'importmap'\n          },\n          children: genImportMap(deps)\n        },\n        {\n          tag: 'script',\n          attrs: {\n            type: 'text/javascript'\n          },\n          children: setDomainCode\n        }\n      ];\n  \n      // 通过 sandbox.config.json 注入的 js 代码\n      const { sandboxConfigJson, parseError } = genSandboxConfigJson(tree);\n      if (!parseError) {\n        if (sandboxConfigJson.evaluateJavaScript) {\n          tags.push({\n            tag: 'script',\n            attrs: {\n              type: 'text/javascript'\n            },\n            children: sandboxConfigJson.evaluateJavaScript\n          });\n        }\n        \n        if (sandboxConfigJson.externalResources && Array.isArray(sandboxConfigJson.externalResources)) {\n          sandboxConfigJson.externalResources.forEach((resource) => {\n            if (resourceIsCss(resource)) {\n              tags.push({\n                tag: 'link',\n                attrs: {\n                  id: 'external-css',\n                  rel: 'stylesheet',\n                  type: 'text/css',\n                  href: resource,\n                  media: 'all'\n                }\n              });\n            } else {\n              tags.push({\n                tag: 'script',\n                attrs: {\n                  id: 'external-js',\n                  async: false,\n                  src: resource\n                }\n              });\n            }\n          });\n        }\n      }\n\n      return {\n        html,\n        tags\n      };\n    }\n  }\n});\n\nexport default htmlPlugin;\n","import {\n  // scanImports,\n  createMissingImporterRegisterFn\n} from 'vite';\nimport path from 'path';\nimport { initDeps, depBaseUrl, genSandboxConfigJson, externalDependencies } from '$utils';\n\nconst genNpmUrl = (depName, deps, tree) => {\n  const { sandboxConfigJson, parseError } = genSandboxConfigJson(tree);\n  if (!parseError && sandboxConfigJson.npmUrlMap) {\n    if (sandboxConfigJson.npmUrlMap[depName]) {\n      return sandboxConfigJson.npmUrlMap[depName];\n    }\n  }\n\n  return `${depBaseUrl}/${depName}@${deps[depName]}?bundle&dev&external=${externalDependencies.join(',')}`;\n};\n\n// eslint-disable-next-line no-unused-vars\nasync function optimizeDeps(config, tree, newDeps) {\n  const mainHash = '0';\n  const data = {\n    hash: mainHash,\n    browserHash: mainHash,\n    optimized: {}\n  };\n\n  const deps = {};\n\n  // 基于 package.json 的 dependencies 初始化 deps 对象\n  initDeps(tree, deps);\n\n  // if (newDeps) {\n  //   console.log('New dependencies: ', Object.keys(newDeps));\n  // } else {\n  //   const { missing } = await scanImports(config);\n  //   newDeps = missing;\n  //   console.log('Scanned dependencies: ', Object.keys(newDeps));\n  // }\n\n  // for (const depName of Object.keys(newDeps)) {\n  //   if (!deps[depName]) {\n  //     deps[depName] = 'latest';\n  //   }\n  // }\n\n  for (const depName of Object.keys(deps)) {\n    data.optimized[depName] = {\n      file: genNpmUrl(depName, deps, tree),\n      needsInterop: false\n    };\n  }\n\n  return data;\n}\n\n// 处理被构建应用的依赖\nasync function runOptimize(channel, server, { ref, tree }, addInitError) {\n  const sendViteServerStatus = (type, data)=> channel.publish(type, Object.assign({ ref }, data));\n  // todo: 暂时只传 server.config\n  // c = xTt(server.config, tree);\n  const config = server.config;\n  const filePath = path.join(server.config.root, 'dist/__require.js');\n\n  try {\n    server._isRunningOptimizer = true;\n    server._optimizeDepsMetadata = await optimizeDeps(config, tree);\n    server.moduleGraph.onFileChange(filePath);\n  } finally {\n    server._isRunningOptimizer = false;\n  }\n\n  server._registerMissingImport = createMissingImporterRegisterFn(\n    server, \n    (_config, _force, _asCommand, newDeps) => optimizeDeps(config, tree, newDeps)\n      .then(data => {\n        server.moduleGraph.onFileChange(filePath);\n        sendViteServerStatus('vite-server-status', {\n          status: 'successful'\n        });\n        return data;\n      }).catch(error => {\n        addInitError(error);\n        sendViteServerStatus('vite-server-status', {\n          status: 'failed'\n        });\n        return error;\n      })\n  );\n}\n\nexport default runOptimize;\n","import {\n  transformRequest,\n  resolveConfig,\n  createPluginContainer,\n  createDevHtmlTransformFn,\n  ModuleGraph,\n  transformWithEsbuild,\n  ssrTransform,\n  // ssrLoadModule,\n  generateCodeFrame\n} from 'vite';\nimport reactPlugin from '@vitejs/plugin-react';\nimport pluginTransformReactJsx from '@babel/plugin-transform-react-jsx';\nimport viteClientPlugin from './plugins/viteClientPlugin';\nimport nodeResolvePlugin from './plugins/nodeResolvePlugin';\nimport htmlPlugin from './plugins/htmlPlugin';\nimport runOptimize from './optimize';\n\nfunction Nlt(id, text) {\n  return text.replace(new RegExp(`(\\\\S+:)?/?@root/${id}`,'g'), '');\n}\n\nasync function createServer(channel, { cfg, wc, baseUrl }, addInitError) {\n  const bablePlugins = [\n    pluginTransformReactJsx\n  ];\n\n  const vitePlugins = [\n    // virtual plugin to provide vite client/env special entries (see below)\n    viteClientPlugin(),\n    // virtual plugin to resolve NPM dependencies, e.g. using unpkg, skypack or another provider (browser-vite only handles project files)\n    nodeResolvePlugin({\n      tree: wc.tree\n    }),\n    // add vite plugins you need here (e.g. vue, react, astro ...)\n    reactPlugin({\n      jsxRuntime: 'classic',\n      babel: {\n        plugins: bablePlugins\n      }\n    }),\n    htmlPlugin({\n      tree: wc.tree\n    })\n  ];\n\n  // 暂时只支持 react\n  const config = await resolveConfig(\n    {\n      plugins: vitePlugins,\n      base: `${baseUrl}/${wc.ref.id}/`,\n      cacheDir: 'browser',\n      root: cfg.root,\n      resolve: {\n        alias: cfg.alias\n      }\n    }, \n    'serve'\n  );\n  const plugins = config.plugins;\n  const pluginContainer = await createPluginContainer(config);\n  const moduleGraph = new ModuleGraph((url, ssr) => pluginContainer.resolveId(url, undefined, {\n    ssr\n  }));\n\n  const watcher = {\n    // eslint-disable-next-line no-unused-vars\n    on(what, cb) {\n      return watcher;\n    },\n    add() {}\n  };\n  const server = {\n    config,\n    pluginContainer,\n    moduleGraph,\n    transformWithEsbuild,\n    transformRequest(url, options) {\n      return transformRequest(url, server, options);\n    },\n    ssrTransform,\n    printUrls() {},\n    transformIndexHtml: null,\n    _globImporters: {},\n    ws: {\n      send(data) {\n        const err = data.err;\n\n        if (err) {\n          data.err = Object.assign({}, err, {\n            stack: err.stack,\n            message: err.message\n          });\n        }\n        channel.publish('vite-hmr', Object.assign({}, data, { ref: wc.ref }));\n      },\n      async close() {},\n      on() {},\n      off() {}\n    },\n    middlewares: false,\n    app: undefined,\n    httpServer: undefined,\n    watcher: watcher,\n    async ssrLoadModule() {\n      // // todo: loadModule 待实现\n      // return ssrLoadModule(url, server, () => null);\n    },\n    ssrFixStacktrace() {},\n    listen: undefined,\n    async close() {},\n    async restart() {},\n    _optimizeDepsMetadata: null,\n    _isRunningOptimizer: false,\n    _pendingReload: undefined,\n    _registerMissingImport: undefined,\n    _ssrExternals: [],\n    _restartPromise: null,\n    _forceOptimizeOnRestart: false,\n    _pendingRequests: new Map()\n  };\n\n  server.transformIndexHtml = createDevHtmlTransformFn(server);\n\n  // apply server configuration hooks from plugins\n  const postHooks = [];\n  for (const plugin of plugins) {\n    if (plugin.configureServer) {\n      postHooks.push(await plugin.configureServer(server));\n    }\n  }\n\n  // run post config hooks\n  // This is applied before the html middleware so that user middleware can\n  // serve custom content instead of index.html.\n  postHooks.forEach((fn) => fn && fn());\n\n  let initError;\n  try {\n    await pluginContainer.buildStart({});\n    await runOptimize(channel, server, wc, addInitError);\n  } catch (error) {\n    initError = error,\n    initError.message = error.message.replace(/^Build failed with \\d+ error.*:/, 'Failed to start compilation server:');\n    const { location } = (error.errors == null ? undefined : error.errors[0]) || {};\n\n    if (location?.file) {\n      initError.id = `${location.file}:${location?.line || 0}:${location?.column || 0}`;\n      initError.loc = location;\n      initError.frame = generateCodeFrame(wc.tree[Nlt(wc.ref.id, location.file).slice(1)], location);\n    }\n  }\n\n  const createResolver = config.createResolver;\n  config.createResolver = option =>{\n    const resolveFn = createResolver(option);\n    return async(id, importer, aliasOnly, ssr)=>{\n      const code = await resolveFn(id, importer, aliasOnly, ssr);\n      // if (!code && !aliasOnly) {\n      //     let ret = dependencyNameRE.exec(id);\n      //     if (ret) {\n      //         let [name, version, pathname] = ret.slice(1);\n      //         let _optimizeDepsMetadata = R._optimizeDepsMetadata;\n      //         let versionedEntry = _optimizeDepsMetadata?.$pinDependency$(version ? `${name}@${version}` : name);\n      //         if (versionedEntry) {\n      //             let ce = await i4r(versionedEntry);\n      //             for (let[fe, A] of Object.entries(ce)) {\n      //                 let W = path.join(e.root, 'node_modules', name, fe);\n      //                 uN(W, A);\n      //             }\n      //             code = await resolveFn(path.join(e.root, 'node_modules', name, pathname), importer, aliasOnly, ssr)\n      //         }\n      //     }\n      // }\n      return code;\n    };\n  };\n  \n  return {\n    server,\n    initError\n  };\n}\n\nexport default createServer;\n","import {\n  transformRequest,\n  isCSSRequest,\n  isDirectCSSRequest,\n  injectQuery,\n  removeImportQuery,\n  unwrapId,\n  handleFileAddUnlink,\n  handleHMRUpdate\n} from 'vite';\nimport fs from 'fs';\nimport path from 'path';\nimport {\n  writeProjectFiles,\n  genProjectInfo,\n  sendCompileError,\n  getImageContentType,\n  findPathName,\n  genPkgJson,\n  genErrorHtmlCode,\n  enhanceErrorInfo\n} from '$utils';\nimport Channel from '$utils/channel';\nimport '$utils/initFiles/index';\nimport createServer from './server';\n\nconst compileContexts = new Map();\n\nconst { busid, wcid } = self;\n\nconst channel = new Channel(busid);\n\n// 创建编译上下文\nasync function createCompileContext(projectInfo, wc, parseError) {\n  channel.publish('vite-server-status', {\n    ref: wc.ref,\n    status: 'initializing'\n  });\n\n  // eslint-disable-next-line prefer-const\n  let compileContext;\n\n  const { server, initError } = await createServer(channel, {\n    cfg: projectInfo,\n    wc,\n    baseUrl: `/${channel.channelName}/vite`\n  }, err => compileContext.initError = err);\n\n  compileContext = {\n    cfg: projectInfo,\n    wc,\n    server,\n    initError: parseError ? parseError : initError\n  };\n\n  return compileContext;\n}\n\n// 根据消息决定初始化编译上下文\nchannel.subscribe('tree-compilation-request', async (data) => {\n  const { compiler_type, tree } = data;\n\n  if (compiler_type === 'vite') {\n    const { pkgJson, parseError } = genPkgJson(tree);\n    const compileContext = compileContexts.get(wcid);\n    let isFileUpdate = compileContext && !compileContext.initError;\n    const projectInfo = await genProjectInfo(tree, pkgJson, wcid);\n\n    // 向内存文件系统写入需要构建应用的源码\n    writeProjectFiles(projectInfo.root, tree);\n\n    if (isFileUpdate) {\n      const { wc } = compileContext;\n\n      if (parseError) {\n        compileContext.initError = parseError;\n      }\n\n      // 只要项目信息（例如依赖或 tsconfig/jsconfig 等文件内容）不变，则尝试热更新处理\n      // 文件变动后（新增/删除/文案内容变动）的热更新处理\n      if (JSON.stringify(projectInfo) === JSON.stringify(compileContext.cfg)) {\n        const { server } = compileContext;\n        const { root } = server.config;\n        for (const filePath in wc.tree) {\n          // 1. 文件内容变更情况\n          if (filePath in tree) {\n            if (tree[filePath] !== wc.tree[filePath]) {\n              server.moduleGraph.onFileChange(path.join(root, filePath));\n              try {\n                await handleHMRUpdate(path.join(root, filePath), tree[filePath], server);\n              } catch(err) {\n                server.ws.send({\n                  type: 'error',\n                  err\n                });\n              }\n            }\n          } else {\n            // 2. 删除文件情况\n            handleFileAddUnlink(path.join(root, filePath), server, true);\n            delete wc.tree[filePath];\n          }\n        }\n\n        for (const filePath in tree) {\n          // 3. 新增文件情况\n          if (!(filePath in wc.tree)) {\n            handleFileAddUnlink(path.join(root, filePath), server, false);\n            server.ws.send({\n              type: 'full-reload',\n              path: filePath\n            });\n            wc.tree[filePath] = tree[filePath];\n          }\n        }\n      } else {\n        compileContext.server.close();\n        isFileUpdate = false;\n      }\n    }\n\n    if (!isFileUpdate) {\n      try {\n        const compileContext = await createCompileContext(projectInfo, {\n          tree,\n          ref: {\n            id: wcid\n          }\n        }, parseError);\n        compileContexts.set(wcid, compileContext);\n        compileContext.server.ws.send({\n          type: 'full-reload'\n        });\n        // 完成 compileContext 上下文初始化\n        self.postMessage({\n          cmd: 'compile-context-inited'\n        });\n      } catch (err) {\n        sendCompileError(channel, err, wcid);\n        channel.publish('tree-compile-failure', {\n          wcid\n        });\n        return;\n      }\n    }\n\n    channel.publish('tree-compile-success', {\n      wcid,\n      imports: [],\n      tree: {}\n    });\n  }\n});\n\n// 重新创建编译上下文\nchannel.subscribe('vite-reload-request', async({ reqId, wcid }) => {\n  const compileContext = compileContexts.get(wcid);\n  if (compileContext) {\n    compileContexts.delete(compileContext);\n    compileContext.server.close();\n\n    const { wc } = compileContext;\n    try {\n      const { pkgJson, parseError } = genPkgJson(wc.tree);\n      const projectInfo = await genProjectInfo(wc.tree, pkgJson, wcid);\n      const compileContext = await createCompileContext(projectInfo, wc, parseError);\n      compileContexts.set(wcid, compileContext);\n    } catch (err) {\n      sendCompileError(channel, err, wcid);\n    }\n  }\n\n  channel.publish('vite-reload-response', {\n    reqId,\n    result: {}\n  });\n});\n\n// 根据 service worker 捕获的请求编译对应代码并返回\nchannel.subscribe('serve-request', async({ reqId, pathname, rawUrl, accept }) => {\n  // 当 path 以 / 结尾时，则均指向 index.html\n  if (pathname.endsWith('/')) {\n    pathname = '/index.html';\n    accept = 'text/html';\n  }\n\n  // test\n  if (pathname.endsWith('/d2c') || pathname.endsWith('/user/:userId')) {\n    pathname = '/index.html';\n    accept = 'text/html';\n  }\n\n  let result = {};\n\n  try {\n    const compileContext = compileContexts.get(wcid);\n    if (!compileContext) {\n      throw new Error('Vite server not yet started');\n    }\n    const { server, wc, initError } = compileContext;\n    const html = accept?.includes('text/html');\n    let code;\n\n    // strip ?import\n    pathname = removeImportQuery(pathname);\n    // Strip valid id prefix. This is prepended to resolved Ids that are\n    // not valid browser import specifiers by the importAnalysis plugin.\n    pathname = unwrapId(pathname);\n    // for CSS, we need to differentiate between normal CSS requests and\n    // imports\n    if (isCSSRequest(pathname) && accept?.includes('text/css')) {\n      pathname = injectQuery(pathname, 'direct');\n    }\n\n    let contentType;\n\n    if (isDirectCSSRequest(pathname)) {\n      contentType = 'text/css';\n    } else if (html) {\n      contentType = 'text/html';\n    } else if (accept?.includes('image/')) {\n      contentType = getImageContentType(pathname);\n    } else {\n      contentType = 'application/javascript';\n    }\n\n    if (initError && pathname !== '/@vite/client') {\n      code = genErrorHtmlCode(channel, contentType, initError, wcid);\n    } else {\n      let path = pathname;\n      try {\n        if (html) {\n          // 从被构建的前端应用源码中查找对应文件，如果存在则编译该文件\n          path = findPathName(path, Object.keys(wc.tree));\n          if (path) {\n            code = await server.transformIndexHtml(path, wc.tree[path]);\n          } else if (pathname.startsWith('/@virtual/')) {\n            code = await server.transformIndexHtml(pathname, '');\n          }\n        } else if (contentType.startsWith('image/')) {\n          const ret = fs.readFileSync(`${compileContext.cfg.root}${path}`, 'utf8');\n          code = ret.buffer || ret;\n        } else {\n          // transformRequest 从 vite 中获取\n          const ret = await transformRequest(pathname, server, { html });\n          code = ret?.code; \n        }\n      } catch (err) {\n        enhanceErrorInfo(err, wc.tree, path, pathname),\n        server.ws.send({\n          type: 'error',\n          err\n        });\n        if (contentType !== 'text/css') {\n          code = genErrorHtmlCode(channel, contentType, err, wcid);\n        }\n      }\n    }\n\n    if (code) {\n      const viteCache = await caches.open('vite');\n      await viteCache.put(new Request(rawUrl), new Response(code, {\n        headers: { \n          'Content-Type': contentType\n        }\n      }));\n\n      result = {\n        cache: true,\n        url: pathname\n      };\n    } else {\n      result = {\n        notfound: true,\n        url: pathname\n      };\n    }\n  } catch (error) {\n    console.log(error);\n    result = {\n      error: error.message,\n      url: pathname\n    };\n  }\n\n  channel.publish('serve-response', {\n    reqId,\n    result\n  });\n});\n","class Channel {\n  constructor(channelName) {\n    this.channelName = channelName;\n    this.listeners = new Map();\n    this.broadcastChannel = new BroadcastChannel(channelName);\n    this.broadcastChannel.addEventListener('message', this.onEvent.bind(this));\n  }\n\n  subscribe(type, callback) {\n    let callbacks = this.listeners.get(type);\n\n    if (!callbacks) {\n      callbacks = new Set();\n      this.listeners.set(type, callbacks);\n    }\n\n    callbacks.add(callback);\n\n    return () => {\n      const callbacks = this.listeners.get(type);\n      if (callbacks) {\n        callbacks.delete(callback);\n      }\n    };\n  }\n\n  request(originType = 'serve-request', data) {\n    const reqId = Date.now().toString(36);\n    const type = originType.toString().replace('request', 'response');\n\n    return new Promise(resolve => {\n      const clear = this.subscribe(type, response => {\n        if (response.reqId === reqId) {\n          clear();\n          delete response.reqId;\n          resolve(response.result);\n        }\n      });\n\n      this.publish(originType, { ...data, reqId });\n    });\n  }\n\n  publish(type, data) {\n    this.broadcastChannel.postMessage({\n      type,\n      data\n    });\n  }\n\n  onEvent(event) {\n    this.notifyListeners(event.data.type, event.data.data);\n  }\n\n  notifyListeners(type, data) {\n    const callbacks = this.listeners.get(type);\n    if (callbacks) {\n      callbacks.forEach(callback=>{\n        try {\n          callback(data);\n        } catch (err) {\n          console.error(err);\n        }\n      });\n    }\n  }\n}\n\nexport default Channel;\n"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","webpackEmptyContext","initializePromise","initialize","worker","Worker","wasmURL","transform","r","then","formatMessages","promises","fs","builtinModules","createRequire","performance","now","Date","getTime","URL","globalThis","URLSearchParams","pathToFileURL","path","fileURLToPath","url","protocol","pathname","packageJsonPath","sandboxConfigJsonPath","depBaseUrl","dependencyNameRE","configFileNames","externalDependencies","genImportMap","deps","importMap","imports","depName","version","join","JSON","stringify","writeFileSync","_path","contents","recursive","error","console","log","genSandboxConfigJson","tree","sandboxConfigJson","parse","message","parseError","genPkgJson","pkgJson","initDeps","dependencies","entries","forEach","name","ver","genProjectInfo","wcid","devDependencies","peerDependencies","isSomeFrameWork","useReact","useSolid","useVue","useSvelte","useStencil","root","configFiles","fromEntries","configFileName","sendCompileError","channel","err","Array","isArray","publish","errors","stack","filename","lineno","start","line","colno","column","_findPathName","pathNameArr","i","RegExp","find","p","test","genErrorHtmlCode","contentType","channelName","server","enforce","configureServer","_server","resolveId","_","ssr","dependencyInfos","exec","external","_optimizeDepsMetadata","depData","optimized","src","file","dependencyName","load","warn","transformIndexHtml","html","tags","tag","attrs","type","children","evaluateJavaScript","push","externalResources","resource","match","includes","resourceIsCss","async","rel","href","media","genNpmUrl","npmUrlMap","optimizeDeps","config","newDeps","data","hash","browserHash","needsInterop","cfg","wc","baseUrl","addInitError","bablePlugins","vitePlugins","startsWith","jsxRuntime","babel","plugins","base","ref","cacheDir","alias","pluginContainer","moduleGraph","undefined","watcher","on","what","cb","add","transformWithEsbuild","transformRequest","options","ssrTransform","printUrls","_globImporters","ws","send","assign","off","middlewares","app","httpServer","ssrFixStacktrace","listen","_isRunningOptimizer","_pendingReload","_registerMissingImport","_ssrExternals","_restartPromise","_forceOptimizeOnRestart","_pendingRequests","Map","postHooks","plugin","initError","fn","buildStart","sendViteServerStatus","filePath","onFileChange","_config","_force","_asCommand","status","catch","replace","location","loc","frame","text","slice","createResolver","option","resolveFn","importer","aliasOnly","compileContexts","busid","self","constructor","this","listeners","broadcastChannel","BroadcastChannel","addEventListener","onEvent","bind","subscribe","callback","callbacks","get","Set","set","delete","request","originType","reqId","toString","Promise","clear","response","result","postMessage","event","notifyListeners","createCompileContext","projectInfo","compileContext","compiler_type","isFileUpdate","writeProjectFiles","close","cmd","rawUrl","accept","endsWith","extname","getImageContentType","findPathName","ret","buffer","source","dependency","enhanceErrorInfo","viteCache","caches","open","put","Request","Response","headers","cache","notfound"],"sourceRoot":""}